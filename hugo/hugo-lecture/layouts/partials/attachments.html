{{ $attachments := .Params.attachments }}
{{ $title       := .Scratch.Get "attachments_title" | default "Materialien" }}

{{ if $attachments }}

    {{ $c := "<ul>" }}
    {{ range $attachments }}
        {{ $n := index . "name" | default "(annotierter) Foliensatz" }}
        {{ with index . "link" }}
            {{ $url := urls.Parse . }}
            {{ if $url.Scheme }}
                {{ $url = $url.String }}
            {{ else }}
                {{ $url = $url.Path }}
                {{ with (strings.TrimPrefix "/" $.Page.File.Dir) }}
                    {{/* if not on "home" page: use path to file */}}
                    {{ $url = printf "%s/%s" . $url }}
                {{ end }}
                {{ $url = $url | path.Clean | absURL }}

                {{ if $.Site.IsMultiLingual }}
                    {{/*
                        Hugo will include the current language code as subdir in the URL, but the
                        additional content (images, files, ...) will be placed in the default
                        language dir only. So the content will not be reachable using the correct
                        URL generated by Hugo, and we have to use the URL pointing to the default
                        language dir in all language variants.

                        Replace the current language code in the path with the language code for the
                        default language, e.g. replace "/ma/" w/ "/ba/" in "path/ma/images/wuppie.png"
                        (result: "path/ba/images/wuppie.png").
                    */}}
                    {{ $default_lang := printf "/%s/" (index $.Site.Languages 0).Lang }}
                    {{ $current_lang := printf "%s/" $.Site.LanguagePrefix }}
                    {{ $url = replace $url $current_lang $default_lang }}
                {{ end }}
            {{ end }}
            {{ $c = printf "%s <li><a href='%s' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>%s</a></li>" $c ($url | safeURL) $n }}
        {{ end }}
    {{ end }}
    {{ $c = printf "%s</ul>" $c }}

    {{ partial "shortcodes/notice.html" (dict
        "page" .
        "style" "info"
        "icon" "far fa-file-powerpoint"
        "title" $title
        "content" $c
    )}}

{{ end }}
